import{p as W,aG as Z,aH as ee,aI as ae,g as le,D as te,aJ as oe,aK as se,o as re,u as ue,aL as ne,aM as H,aN as z,c as l,H as O,Y as ie,x as r,ae as N,a0 as G,a1 as J,a2 as de,a4 as o,aO as ce,a6 as me,aq as pe,K as S,ab as I,as as A,aP as ve,V as ge,a3 as Ve,a5 as be,a8 as s,ar as fe,al as ye,ag as ke,ai as xe,aQ as Ce,ak as he,ad as we,aj as Pe,X as Be}from"./index-8611a10a.js";import{c as Fe,a as L,e as Ue,f as Me,u as Se,d as k,V as Ie}from"./index.esm-033b5df8.js";import{V as Ae}from"./VContainer-5e5cbc8d.js";import{a as De,V as D}from"./VRow-7f160328.js";import"./_commonjsHelpers-39b5b250.js";const _e=W({...Z(),...ee(ae(),["inline"])},"VCheckbox"),$e=le()({name:"VCheckbox",inheritAttrs:!1,props:_e(),emits:{"update:modelValue":u=>!0,"update:focused":u=>!0},setup(u,g){let{attrs:V,slots:d}=g;const n=te(u,"modelValue"),{isFocused:b,focus:_,blur:f}=oe(u),x=se(),m=re(()=>u.id||`checkbox-${x}`);return ue(()=>{const[C,i]=ne(V),[$,p]=H.filterProps(u),[c,R]=z.filterProps(u);return l(H,O({class:["v-checkbox",u.class]},C,$,{modelValue:n.value,"onUpdate:modelValue":v=>n.value=v,id:m.value,focused:b.value,style:u.style}),{...d,default:v=>{let{id:h,messagesId:T,isDisabled:q,isReadonly:w}=v;return l(z,O(c,{id:h.value,"aria-describedby":T.value,disabled:q.value,readonly:w.value},i,{modelValue:n.value,"onUpdate:modelValue":K=>n.value=K,onFocus:_,onBlur:f}),d)}})}),{}}}),Te=Pe("h1",{class:"text-center"},"商品管理",-1),Ee={__name:"ProductsView",setup(u){const g=ie(),V=r(5),d=r([{key:"name",order:"asc"}]),n=r(1),b=r([]),_=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"說明",align:"center",sortable:!1,key:"description"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],f=r(!1),x=r(0),m=r(""),C=()=>{n.value=1,i()},i=async()=>{f.value=!0;try{const{data:t}=await N.get("/products/all",{params:{page:n.value,itemsPerPage:V.value,sortBy:d.value[0].key,sortOrder:d.value[0].order,search:m.value}});b.value.splice(0,b.value.length,...t.result.data),x.value=t.result.count}catch(t){g({text:t.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}f.value=!1};i();const $=t=>{c.value=t._id,P.value.value=t.name,B.value.value=t.price,F.value.value=t.description,U.value.value=t.category,M.value.value=t.sell,p.value=!0},p=r(!1),c=r(""),R=()=>{c.value="",p.value=!0},v=()=>{p.value=!1,K(),E.value.deleteFileRecord()},h=["衣服","食品","3C","遊戲"],T=Fe({name:L().required("缺少名稱"),price:Ue().typeError("缺少價格").required("缺少價格").min(0,"價格錯誤"),description:L().required("缺少說明"),category:L().required("缺少分類").test("isCategory",t=>h.includes(t)),sell:Me()}),{handleSubmit:q,isSubmitting:w,resetForm:K}=Se({validationSchema:T,initialValues:{name:"",price:0,description:"",category:"",sell:!1}}),P=k("name"),B=k("price"),F=k("description"),U=k("category"),M=k("sell"),y=r([]),j=r([]),E=r(null),Q=q(async t=>{if(!(c.value.length===0&&y.value.length===0))try{const e=new FormData;e.append("name",t.name),e.append("price",t.price),e.append("description",t.description),e.append("category",t.category),e.append("sell",t.sell),y.value.length>0&&e.append("image",y.value[0].file),c.value.length>0?await N.patch("/products/"+c.value,e):await N.post("/products",e),g({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),v(),i()}catch(e){console.log(e),g({text:e.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return(t,e)=>{const X=G("VDataTableServer"),Y=G("VueFileAgent");return J(),de(me,null,[l(Ae,null,{default:o(()=>[l(De,null,{default:o(()=>[l(D,{cols:"12"},{default:o(()=>[Te]),_:1}),l(pe),l(D,{cols:"12"},{default:o(()=>[l(S,{color:"green",onClick:R},{default:o(()=>[I("新增商品")]),_:1}),l(X,{"items-per-page":V.value,"onUpdate:itemsPerPage":[e[1]||(e[1]=a=>V.value=a),i],"sort-by":d.value,"onUpdate:sortBy":[e[2]||(e[2]=a=>d.value=a),i],page:n.value,"onUpdate:page":[e[3]||(e[3]=a=>n.value=a),i],items:b.value,headers:_,loading:f.value,"items-length":x.value,search:m.value,hover:""},{top:o(()=>[l(A,{label:"搜尋","append-icon":"mdi-magnify","onClick:append":C,onKeydown:ve(C,["enter"]),modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=a=>m.value=a)},null,8,["onKeydown","modelValue"])]),["item.image"]:o(({item:a})=>[l(ge,{src:a.raw.image,height:"50px"},null,8,["src"])]),["item.sell"]:o(({item:a})=>[a.raw.sell?(J(),Ve(Be,{key:0,icon:"mdi-check"})):be("",!0)]),["item.edit"]:o(({item:a})=>[l(S,{icon:"mdi-pencil",onClick:qe=>$(a.raw),variant:"text"},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1}),l(D,{cols:"12"}),l(D,{cols:"12"})]),_:1})]),_:1}),l(ce,{persistent:"",modelValue:p.value,"onUpdate:modelValue":e[11]||(e[11]=a=>p.value=a),width:"500px"},{default:o(()=>[l(Ie,{disabled:s(w),onSubmit:fe(s(Q),["prevent"])},{default:o(()=>[l(ye,null,{default:o(()=>[l(ke,null,{default:o(()=>[I("新增商品")]),_:1}),l(xe,null,{default:o(()=>[l(A,{label:"名稱",modelValue:s(P).value.value,"onUpdate:modelValue":e[4]||(e[4]=a=>s(P).value.value=a),"error-messages":s(P).errorMessage.value},null,8,["modelValue","error-messages"]),l(A,{label:"價格",modelValue:s(B).value.value,"onUpdate:modelValue":e[5]||(e[5]=a=>s(B).value.value=a),modelModifiers:{number:!0},"error-messages":s(B).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","error-messages"]),l(A,{label:"說明",modelValue:s(F).value.value,"onUpdate:modelValue":e[6]||(e[6]=a=>s(F).value.value=a),modelModifiers:{number:!0},"error-messages":s(F).errorMessage.value},null,8,["modelValue","error-messages"]),l(Ce,{label:"分類",modelValue:s(U).value.value,"onUpdate:modelValue":e[7]||(e[7]=a=>s(U).value.value=a),modelModifiers:{number:!0},"error-messages":s(U).errorMessage.value,items:h},null,8,["modelValue","error-messages"]),l($e,{label:"上架",modelValue:s(M).value.value,"onUpdate:modelValue":e[8]||(e[8]=a=>s(M).value.value=a),modelModifiers:{number:!0},"error-messages":s(M).errorMessage.value},null,8,["modelValue","error-messages"]),l(Y,{modelValue:y.value,"onUpdate:modelValue":e[9]||(e[9]=a=>y.value=a),"raw-model-value":j.value,"onUpdate:rawModelValue":e[10]||(e[10]=a=>j.value=a),"max-files":1,"max-size":"1MB",accept:"image/jpg,image/jpeg,image/png",multiple:!1,"error-text":{type:"檔案格式錯誤",size:"檔案太大"},"help-text":"選擇檔案或拖放到這裡",deletable:"",ref_key:"fileAgent",ref:E},null,8,["modelValue","raw-model-value"])]),_:1}),l(he,null,{default:o(()=>[l(we,null,{default:o(()=>[l(S,{color:"red",onClick:v},{default:o(()=>[I("取消")]),_:1}),l(S,{color:"green",type:"submit",loading:s(w)},{default:o(()=>[I("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};export{Ee as default};
